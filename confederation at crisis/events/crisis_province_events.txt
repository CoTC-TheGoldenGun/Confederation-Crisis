namespace = cotcprovince

#this was supposed to be a province event but because it is triggered by an "on_action" it requires to be a character event.
character_event = {
    id = cotcprovince.1
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        FROM = {
            location = {
                fn_crisis_recalctrade_in_province = yes
                fn_crisis_recalcsupply_in_province = yes
            }
        }
    }
}

province_event = {
    id = cotcprovince.10
    hide_window =  yes

    mean_time_to_happen = {
        months = 6
    }

    trigger = {
        has_owner = yes
        any_province_holding = {
            trigger_if = {
                limit = { persistent_event_target:representative = { always = yes } }
                persistent_event_target:representative = {
                    NAND = {
                        is_alive = yes
                        prisoner = no
                        is_incapable = no
                        is_adult = yes
                        religion = ROOT
                        culture = ROOT
                        ai = yes
                        is_ruler = no
                        is_heir = no
                    }
                    log = "Evaluating representative [This.GetBestName] of [Root.GetName]"
                    if = { limit = { is_alive = no } log = "Representative is dead" }
                    if = { limit = { is_incapable = yes } log = "Representative is incapable" }
                    if = { limit = { is_adult = no } log = "Representative is not adult" }
                    if = { limit = { prisoner = yes } log = "Representative is prisoner" }
                    if = { limit = { NOT = { religion = ROOT } } log = "Representative is wrong religion" }
                    if = { limit = { NOT = { culture = ROOT } } log = "Representative is wrong culture" }
                }
            }
            trigger_else = {
                always = yes
                log = "Representative for [Root.GetName] is missing?"
            }
        }
    }

    immediate = {
        any_province_holding = {
            limit = {
                OR = {
                    persistent_event_target:representative = {
                        NAND = {
                            is_alive = yes
                            prisoner = no
                            is_incapable = no
                            is_adult = yes
                            religion = ROOT
                            culture = ROOT
                            ai = yes
                            is_ruler = no
                            is_heir = no
                        }
                    }
                    NOT = { persistent_event_target:representative = { always = yes } }
                }
            }
            persistent_event_target:representative = {
                clear_persistent_event_target = representative_of
            }
            clear_persistent_event_target = representative

            create_character = {
                dynasty = none
                culture = ROOT
                religion = ROOT
                female = 60
            }
            new_character = {
                add_age = 10
                save_persistent_event_target = { name = representative_of scope = PREV }
            }
            save_persistent_event_target = { name = representative scope = new_character }
            log = "Representative of [This.GetName] is [representative.GetBestName] age is [representative.GetAgeYears]"
            log = "Cultures: Root: [This.Culture.GetName] Rep: [representative.Culture.GetName]"
            log = "Religions: Root: [This.Religion.GetName] Rep: [representative.Religion.GetName]"
        }
    }
}
